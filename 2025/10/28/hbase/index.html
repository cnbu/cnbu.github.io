<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>hbase | Hexo</title>
  <meta name="keywords" content=" hexo , 3-hexo ">
  <meta name="description" content="hbase | Hexo">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avata.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 7.3.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avata.jpg"/>
</a>
<div class="author">
    <span>John Doe</span>
</div>

<div class="icon">
    
        
            <a title="rss"
               href="/atom.xml"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-rss"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="github"
               href="https://github.com/cnbu"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="email"
               href="mailto:cnbu@qq.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="qq"
               href="http://wpa.qq.com/msgrd?v=3&uin=31532665&site=qq&menu=yes"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-qq"></use>
                    </svg>
                
            </a>
        
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="All">All
            
                <small>(2)</small>
            
        </div>
    </li>
    
        
            
                
    <li>
        <div data-rel="å¤§æ•°æ®">
            
            å¤§æ•°æ®
            <small>(2)</small>
        </div>
        
    </li>

            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">About</a>
        
        <a style="width: 50%"
                
                                           class="friends">Friends</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="2">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">å¶è½é˜</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="search shortcut key i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="switch to outline view shortcut key w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="return"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="case sensitive"></i>
            <i class="iconfont icon-tag" data-title="label"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">outline</div>
            <i class="iconfont icon-list" data-title="switch to article list"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>3-hexo</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>hexo</a>
            </li>
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        
        <a  class="All å¤§æ•°æ® "
           href="/2025/10/28/hbase/"
           data-tag="hexo,3-hexo"
           data-author="" >
            <span class="post-title" title="hbase">hbase</span>
            <span class="post-date" title="2025-10-28 22:02:05">2025/10/28</span>
        </a>
        
        
        <a  class="All å¤§æ•°æ® "
           href="/2025/10/28/ClouderManager%E5%AE%89%E8%A3%85/"
           data-tag="hexo,3-hexo"
           data-author="" >
            <span class="post-title" title="ClouderManagerå®‰è£…">ClouderManagerå®‰è£…</span>
            <span class="post-date" title="2025-10-28 21:50:30">2025/10/28</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="Toggle full screen shortcut key s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-hbase" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">hbase</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="å¤§æ•°æ®">å¤§æ•°æ®</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color5">hexo</a>
            
            <a class="color2">3-hexo</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2025-10-28 22:04:43'>2025-10-28 22:02</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            Views ğŸ‘€ :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-text">å¸¸ç”¨å‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#HBase-%E5%88%B7%E5%86%99%E4%B8%8E%E5%90%88%E5%B9%B6%E6%9C%BA%E5%88%B6"><span class="toc-text">HBase åˆ·å†™ä¸åˆå¹¶æœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%BF%9B%E8%A1%8C%E5%88%B7%E5%86%99%E5%92%8C%E5%90%88%E5%B9%B6"><span class="toc-text">ä¸ºä»€ä¹ˆè¦è¿›è¡Œåˆ·å†™å’Œåˆå¹¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flush-%E8%A7%A6%E5%8F%91%E6%9D%A1%E4%BB%B6%E5%92%8C%E5%8F%82%E6%95%B0"><span class="toc-text">Flush è§¦å‘æ¡ä»¶å’Œå‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Compaction-%E7%B1%BB%E5%9E%8B%E3%80%81%E8%A7%A6%E5%8F%91%E6%97%B6%E6%9C%BA%E5%92%8C%E5%8F%82%E6%95%B0"><span class="toc-text">Compaction ç±»å‹ã€è§¦å‘æ—¶æœºå’Œå‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Compaction-%E8%A7%A6%E5%8F%91%E6%97%B6%E6%9C%BA"><span class="toc-text">Compaction è§¦å‘æ—¶æœº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Compaction-%E6%A0%B8%E5%BF%83%E5%8F%82%E6%95%B0"><span class="toc-text">Compaction æ ¸å¿ƒå‚æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hbase-master-%E6%97%A5%E5%BF%97%E6%B8%85%E7%90%86"><span class="toc-text">hbase master æ—¥å¿—æ¸…ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HDFS%EF%BC%88hdfs-site-xml%EF%BC%89%E7%9B%B8%E5%85%B3%E8%B0%83%E6%95%B4"><span class="toc-text">HDFSï¼ˆhdfs-site.xmlï¼‰ç›¸å…³è°ƒæ•´</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HBase%EF%BC%88hbase-site-xml%EF%BC%89%E7%9B%B8%E5%85%B3%E8%B0%83%E6%95%B4"><span class="toc-text">HBaseï¼ˆhbase-site.xmlï¼‰ç›¸å…³è°ƒæ•´</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HBase%E8%A1%A8%E5%B1%9E%E6%80%A7%E8%B0%83%E6%95%B4"><span class="toc-text">HBaseè¡¨å±æ€§è°ƒæ•´</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Compression"><span class="toc-text">Compression</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HFile-Block-Size"><span class="toc-text">HFile Block Size</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RegionServer%E8%8A%82%E7%82%B9%E7%A1%AC%E4%BB%B6%E9%85%8D%E7%BD%AE"><span class="toc-text">RegionServerèŠ‚ç‚¹ç¡¬ä»¶é…ç½®</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span><span class="string">hbase</span> <span class="string">shell</span></span><br><span class="line"><span class="number">1.1</span> <span class="string">è¿›å…¥hbase</span> <span class="string">shell</span></span><br><span class="line"><span class="string">./hbase</span> <span class="string">shell</span></span><br><span class="line"><span class="string">æ³¨æ„ï¼šå½“æœªé…ç½®å…¨å±€ç¯å¢ƒå˜é‡æ—¶ï¼Œéœ€è¦åœ¨hbaseå®‰è£…binç›®å½•ä¸‹æ‰§è¡Œè¯¥å‘½ä»¤ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##1.2 é€€å‡ºhbase shell</span></span><br><span class="line"><span class="string">exit</span></span><br><span class="line"><span class="comment">##2.æŸ¥çœ‹è¡¨</span></span><br><span class="line"><span class="comment">##2.1 æŸ¥çœ‹æœ‰å“ªäº›è¡¨</span></span><br><span class="line"><span class="string">list</span></span><br><span class="line"><span class="comment">##2.2 æŸ¥çœ‹è¡¨è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line"><span class="string">describe</span> <span class="string">&#x27;table_name&#x27;</span></span><br><span class="line"><span class="comment">##2.3 æŸ¥çœ‹è¡¨æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="string">exists</span> <span class="string">&#x27;table_name&#x27;</span></span><br><span class="line"><span class="number">3</span><span class="string">.åˆ›å»ºè¡¨ã€æ¸…è¡¨è¡¨ã€åˆ é™¤è¡¨</span></span><br><span class="line"><span class="comment">##3.1 åˆ›å»ºè¡¨</span></span><br><span class="line"> <span class="string">create</span> <span class="string">&#x27;table_name&#x27;</span><span class="string">,</span> <span class="string">&#x27;info&#x27;</span></span><br><span class="line"><span class="string">æ³¨ï¼šinfoä¸ºåˆ—æ—ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##3.2 æ¸…ç©ºè¡¨</span></span><br><span class="line"><span class="string">truncate</span> <span class="string">&#x27;table_name&#x27;</span></span><br><span class="line"><span class="comment">##3.3 åˆ é™¤è¡¨</span></span><br><span class="line"><span class="string">disable</span> <span class="string">&#x27;table_name&#x27;</span></span><br><span class="line"><span class="string">æ³¨ï¼šå…ˆä¸‹çº¿è¡¨æ‰èƒ½åˆ é™¤è¡¨ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##3.4 åˆ é™¤æ•´è¡Œæ•°æ®</span></span><br><span class="line"><span class="string">deleteall</span> <span class="string">&#x27;table_name&#x27;</span><span class="string">,&#x27;rowkey_1&#x27;</span> </span><br><span class="line"><span class="string">æ³¨ï¼šåˆ é™¤rowkeyä¸ºrowkey_1çš„æ•´è¡Œæ•°æ®ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##3.5 åˆ é™¤æŒ‡å®šè¡Œå¥çš„å­—æ®µ</span></span><br><span class="line"><span class="string">delete</span> <span class="string">&#x27;table_name&#x27;</span><span class="string">,&#x27;rowkey_1&#x27;,&#x27;info:field1&#x27;</span></span><br><span class="line"><span class="number">4</span><span class="string">.æŸ¥çœ‹æ•°æ®</span></span><br><span class="line"><span class="comment">##4.1 æŸ¥è¯¢ç¬¬1è¡Œæ•°æ®</span></span><br><span class="line"><span class="string">get</span> <span class="string">&#x27;table_name&#x27;</span><span class="string">,&#x27;1&#x27;</span></span><br><span class="line"><span class="comment">##4.2 æŸ¥è¯¢å¤šè¡Œæ•°æ®</span></span><br><span class="line"><span class="string">scan</span> <span class="string">&#x27;table_name&#x27;</span><span class="string">,&#123;LIMIT=&gt;10&#125;</span></span><br><span class="line"><span class="string">æ³¨ï¼šç±»ä¼¼select</span> <span class="string">*</span> <span class="string">from</span> <span class="string">table_name</span> <span class="string">limit</span> <span class="number">10</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##4.3 æ ¹æ®æ—¶é—´æˆ³æŸ¥è¯¢</span></span><br><span class="line"><span class="string">scan</span> <span class="string">&#x27;table_name&#x27;</span><span class="string">,&#123;COLUMNS=&gt;&#x27;info&#x27;,TIMESTAMP=&gt;1682546792234&#125;</span></span><br><span class="line"><span class="comment">##4.4 æ ¹æ®rowkeyæŸ¥è¯¢æ•°æ®</span></span><br><span class="line"><span class="string">get</span> <span class="string">&#x27;table_name&#x27;</span><span class="string">,&#x27;rowkey_1&#x27;</span></span><br><span class="line"><span class="comment">##4.5 æ ¹æ®æ—¶é—´èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line"><span class="string">scan</span> <span class="string">&#x27;table_name&#x27;</span><span class="string">,&#123;TIMERANGE=&gt;[1682546792234,1682546992234]&#125;</span></span><br><span class="line"><span class="comment">##4.6 æ ¹æ®rowkeyèŒƒå›´æŸ¥è¯¢</span></span><br><span class="line"><span class="string">scan</span> <span class="string">&#x27;table_name&#x27;</span><span class="string">,&#123;STARTROW=&gt;&#x27;rowkey_1&#x27;,STOPROW=&gt;&#x27;rowkey_5&#x27;&#125;</span></span><br><span class="line"><span class="comment">##5.ç»Ÿè®¡æ•°æ®</span></span><br><span class="line"><span class="comment">##5.1 å°è¡¨æ•°æ®ç»Ÿè®¡</span></span><br><span class="line"><span class="string">count</span> <span class="string">&#x27;table_name&#x27;</span></span><br><span class="line"><span class="comment">##5.2 å¤§è¡¨æ•°æ®ç»Ÿè®¡</span></span><br><span class="line"><span class="string">org.apache.hadoop.hbase.mapreduce.RowCounter</span> <span class="string">&#x27;table_name&#x27;</span></span><br><span class="line"><span class="string">æ³¨ï¼šROWS=XXXï¼Œå°±æ˜¯æœ€åçš„ç»Ÿè®¡ç»“æœã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##5.3 ç»Ÿè®¡æŒ‡å®šrowkeyèŒƒå›´çš„æ•°æ®é‡</span></span><br><span class="line"><span class="string">count</span> <span class="string">&#x27;table_name&#x27;</span><span class="string">,&#123;STARTROW=&gt;&#x27;rowkey_1&#x27;,STOPROW=&gt;&#x27;rowkey_5&#x27;&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="HBase-åˆ·å†™ä¸åˆå¹¶æœºåˆ¶"><a href="#HBase-åˆ·å†™ä¸åˆå¹¶æœºåˆ¶" class="headerlink" title="HBase åˆ·å†™ä¸åˆå¹¶æœºåˆ¶"></a>HBase åˆ·å†™ä¸åˆå¹¶æœºåˆ¶</h2><h3 id="ä¸ºä»€ä¹ˆè¦è¿›è¡Œåˆ·å†™å’Œåˆå¹¶"><a href="#ä¸ºä»€ä¹ˆè¦è¿›è¡Œåˆ·å†™å’Œåˆå¹¶" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è¿›è¡Œåˆ·å†™å’Œåˆå¹¶"></a>ä¸ºä»€ä¹ˆè¦è¿›è¡Œåˆ·å†™å’Œåˆå¹¶</h3><p>HBase æ˜¯ Google BigTable çš„å¼€æºå®ç°ï¼Œåº•å±‚å­˜å‚¨å¼•æ“æ˜¯åŸºäº LSM æ ‘ï¼ˆLog-Structured Merge Treeï¼‰æ•°æ®ç»“æ„è®¾è®¡çš„ã€‚å†™å…¥æ•°æ®æ—¶ä¼šå…ˆå†™ WAL æ—¥å¿—ï¼Œå†å°†æ•°æ®å†™åˆ°å†™ç¼“å­˜ MemStore ä¸­ï¼Œç­‰å†™ç¼“å­˜è¾¾åˆ°ä¸€å®šè§„æ¨¡æˆ–å…¶ä»–è§¦å‘æ¡ä»¶æ—¶ä¼š Flush åˆ·å†™åˆ°ç£ç›˜ï¼Œç”Ÿæˆä¸€ä¸ª HFile æ–‡ä»¶ï¼Œè¿™æ ·å°±å°†ç£ç›˜éšæœºå†™å˜æˆäº†é¡ºåºå†™ï¼Œæé«˜äº†å†™æ€§èƒ½ã€‚åŸºæœ¬æ‹“æ‰‘å›¾ï¼š</p>
<p><img src="D:\notes\cnbu.github.io\05ã€å¤§æ•°æ®\assets\etdsedpxzp.png"></p>
<p>éšç€æ—¶é—´æ¨ç§»ï¼Œå†™å…¥çš„ HFile ä¼šè¶Šæ¥è¶Šå¤šï¼Œè¯»å–æ•°æ®æ—¶å°±ä¼šå› ä¸ºè¦è¿›è¡Œå¤šæ¬¡ioå¯¼è‡´æ€§èƒ½é™ä½ï¼Œå› æ­¤ HBase ä¼šå®šæœŸæ‰§è¡Œ Compaction æ“ä½œä»¥åˆå¹¶å‡å°‘ HFile æ•°é‡ï¼Œæå‡è¯»æ€§èƒ½ã€‚</p>
<h3 id="Flush-è§¦å‘æ¡ä»¶å’Œå‚æ•°"><a href="#Flush-è§¦å‘æ¡ä»¶å’Œå‚æ•°" class="headerlink" title="Flush è§¦å‘æ¡ä»¶å’Œå‚æ•°"></a>Flush è§¦å‘æ¡ä»¶å’Œå‚æ•°</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">ç†è§£</span> <span class="string">Flush</span> <span class="string">çš„è§¦å‘æ¡ä»¶éå¸¸é‡è¦ï¼Œä»ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºä½•æ—¶ä¼šé˜»å¡å†™è¯·æ±‚ï¼Œæ€»ç»“æœ‰</span> <span class="number">7</span> <span class="string">ç§æƒ…å†µä¼šè§¦å‘</span> <span class="string">Flushï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="string">å½“ä¸€ä¸ª</span> <span class="string">MemStore</span> <span class="string">å¤§å°è¾¾åˆ°é˜ˆå€¼</span> <span class="string">hbase.hregion.memstore.flush.sizeï¼ˆé»˜è®¤128Mï¼‰æ—¶ï¼Œä¼šè§¦å‘</span> <span class="string">MemStore</span> <span class="string">çš„åˆ·å†™ã€‚è¿™ä¸ªæ—¶å€™ä¸ä¼šé˜»å¡å†™è¯·æ±‚ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="string">å½“ä¸€ä¸ª</span> <span class="string">Region</span> <span class="string">ä¸­æ‰€æœ‰</span> <span class="string">MemStore</span> <span class="string">æ€»å¤§å°è¾¾åˆ°</span> <span class="string">hbase.hregion.memstore.block.multiplier</span> <span class="string">*</span> <span class="string">hbase.hregion.memstore.flush.sizeï¼ˆé»˜è®¤4*128M=512Mï¼‰æ—¶ï¼Œä¼šè§¦å‘</span> <span class="string">MemStore</span> <span class="string">çš„åˆ·å†™ï¼Œå¹¶é˜»å¡</span> <span class="string">Region</span> <span class="string">æ‰€æœ‰çš„å†™è¯·æ±‚ï¼Œæ­¤æ—¶å†™æ•°æ®ä¼šå‡ºç°</span> <span class="string">RegionTooBusyException</span> <span class="string">å¼‚å¸¸ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="string">å½“ä¸€ä¸ª</span> <span class="string">RegionServer</span> <span class="string">ä¸­æ‰€æœ‰</span> <span class="string">MemStore</span> <span class="string">æ€»å¤§å°è¾¾åˆ°</span> <span class="string">hbase.regionserver.global.memstore.size.lower.limit</span> <span class="string">*</span> <span class="string">hbase.regionserver.global.memstore.size</span> <span class="string">*</span> <span class="string">hbase_heapsizeï¼ˆä½æ°´ä½é˜ˆå€¼ï¼Œé»˜è®¤0.95</span> <span class="string">*</span> <span class="number">0.4</span> <span class="string">*</span> <span class="string">RS</span> <span class="string">å †å¤§å°ï¼‰æ—¶ï¼Œä¼šè§¦å‘</span> <span class="string">RegionServer</span> <span class="string">ä¸­å†…å­˜å ç”¨å¤§çš„</span> <span class="string">MemStore</span> <span class="string">çš„åˆ·å†™ï¼›è¾¾åˆ°</span> <span class="string">hbase.regionserver.global.memstore.size</span> <span class="string">*</span> <span class="string">hbase_heapsizeï¼ˆé«˜æ°´ä½é˜ˆå€¼ï¼Œé»˜è®¤0.4</span> <span class="string">*</span> <span class="string">RSå †å¤§å°ï¼‰æ—¶ï¼Œä¸ä»…ä¼šè§¦å‘</span> <span class="string">Memstore</span> <span class="string">çš„åˆ·å†™ï¼Œè¿˜ä¼šé˜»å¡</span> <span class="string">RegionServer</span> <span class="string">æ‰€æœ‰çš„å†™è¯·æ±‚ï¼Œç›´åˆ°</span> <span class="string">Memstore</span> <span class="string">æ€»å¤§å°é™åˆ°ä½æ°´ä½é˜ˆå€¼ä»¥ä¸‹ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="string">å½“ä¸€ä¸ª</span> <span class="string">RegionServer</span> <span class="string">çš„</span> <span class="string">HLog</span> <span class="string">å³WALæ–‡ä»¶æ•°é‡è¾¾åˆ°ä¸Šé™ï¼ˆå¯é€šè¿‡å‚æ•°</span> <span class="string">hbase.regionserver.maxlogs</span> <span class="string">é…ç½®ï¼Œé»˜è®¤32ï¼‰æ—¶ï¼Œä¹Ÿä¼šè§¦å‘</span> <span class="string">MemStore</span> <span class="string">çš„åˆ·å†™ï¼ŒHBase</span> <span class="string">ä¼šæ‰¾åˆ°æœ€æ—§çš„</span> <span class="string">HLog</span> <span class="string">æ–‡ä»¶å¯¹åº”çš„</span> <span class="string">Region</span> <span class="string">è¿›è¡Œåˆ·å†™</span> <span class="string">ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="string">å½“ä¸€ä¸ª</span> <span class="string">Region</span> <span class="string">çš„æ›´æ–°æ¬¡æ•°è¾¾åˆ°</span> <span class="string">hbase.regionserver.flush.per.changesï¼ˆé»˜è®¤30000000å³3åƒä¸‡ï¼‰æ—¶ï¼Œä¹Ÿä¼šè§¦å‘</span> <span class="string">MemStore</span> <span class="string">çš„åˆ·å†™ã€‚</span></span><br><span class="line"> <span class="string">å®šæœŸ</span> <span class="string">hbase.regionserver.optionalcacheflushintervalï¼ˆé»˜è®¤3600000å³ä¸€ä¸ªå°æ—¶ï¼‰è¿›è¡Œ</span> <span class="string">MemStore</span> <span class="string">çš„åˆ·å†™ï¼Œç¡®ä¿</span> <span class="string">MemStore</span> <span class="string">ä¸ä¼šé•¿æ—¶é—´æ²¡æœ‰æŒä¹…åŒ–ã€‚ä¸ºé¿å…æ‰€æœ‰çš„</span> <span class="string">MemStore</span> <span class="string">åœ¨åŒä¸€æ—¶é—´è¿›è¡Œ</span> <span class="string">flush</span> <span class="string">è€Œå¯¼è‡´é—®é¢˜ï¼Œå®šæœŸçš„</span> <span class="string">flush</span> <span class="string">æ“ä½œä¼šæœ‰ä¸€å®šæ—¶é—´çš„éšæœºå»¶æ—¶ã€‚</span></span><br><span class="line"> <span class="string">æ‰‹åŠ¨æ‰§è¡Œ</span> <span class="string">flush</span> <span class="string">æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡</span> <span class="string">hbase</span> <span class="string">shell</span> <span class="string">æˆ–</span> <span class="string">API</span> <span class="string">å¯¹ä¸€å¼ è¡¨æˆ–ä¸€ä¸ª</span> <span class="string">Region</span> <span class="string">è¿›è¡Œ</span> <span class="string">flushã€‚</span></span><br><span class="line"><span class="string">ä¸Šé¢æ˜¯</span> <span class="string">Flush</span> <span class="string">çš„å‡ ä¸ªè§¦å‘æ¡ä»¶ï¼Œä»ä¸­æˆ‘ä»¬æ‹¿åˆ°</span> <span class="number">5</span> <span class="string">ä¸ªå’Œ</span> <span class="string">Flush</span> <span class="string">æœ‰å…³çš„é‡è¦å‚æ•°ï¼Œå¹¶ç»™å‡ºè°ƒæ•´å»ºè®®ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span><span class="string">ã€hbase.hregion.memstore.flush.size</span></span><br><span class="line"></span><br><span class="line"><span class="string">é»˜è®¤å€¼</span> <span class="string">128Mï¼Œå•ä¸ª</span> <span class="string">MemStore</span> <span class="string">å¤§å°è¶…è¿‡è¯¥é˜ˆå€¼å°±ä¼šè§¦å‘</span> <span class="string">Flushã€‚å¦‚æœå½“å‰é›†ç¾¤</span> <span class="string">Flush</span> <span class="string">æ¯”è¾ƒé¢‘ç¹ï¼Œå¹¶ä¸”å†…å­˜èµ„æºæ¯”è¾ƒå……è£•ï¼Œå»ºè®®é€‚å½“è°ƒæ•´ä¸º</span> <span class="string">256Mã€‚è°ƒå¤§çš„å‰¯ä½œç”¨å¯èƒ½æ˜¯é€ æˆå®•æœºæ—¶éœ€è¦åˆ†è£‚çš„</span> <span class="string">HLog</span> <span class="string">æ•°é‡å˜å¤šï¼Œä»è€Œå»¶é•¿æ•…éšœæ¢å¤æ—¶é—´ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span><span class="string">ã€hbase.hregion.memstore.block.multiplier</span></span><br><span class="line"></span><br><span class="line"><span class="string">é»˜è®¤å€¼</span> <span class="number">4</span><span class="string">ï¼ŒRegion</span> <span class="string">ä¸­æ‰€æœ‰</span> <span class="string">MemStore</span> <span class="string">è¶…è¿‡å•ä¸ª</span> <span class="string">MemStore</span> <span class="string">å¤§å°çš„å€æ•°è¾¾åˆ°è¯¥å‚æ•°å€¼æ—¶ï¼Œå°±ä¼šé˜»å¡å†™è¯·æ±‚å¹¶å¼ºåˆ¶</span> <span class="string">Flushã€‚ä¸€èˆ¬ä¸å»ºè®®è°ƒæ•´ï¼Œä½†å¯¹äºå†™å…¥è¿‡å¿«ä¸”å†…å­˜å……è£•çš„åœºæ™¯ï¼Œä¸ºé¿å…å†™é˜»å¡ï¼Œå¯ä»¥é€‚å½“è°ƒæ•´åˆ°5~8ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span><span class="string">ã€hbase.regionserver.global.memstore.size</span></span><br><span class="line"></span><br><span class="line"><span class="string">é»˜è®¤å€¼</span> <span class="number">0.4</span><span class="string">ï¼ŒRegionServer</span> <span class="string">ä¸­æ‰€æœ‰</span> <span class="string">MemStore</span> <span class="string">å¤§å°æ€»å’Œæœ€å¤šå </span> <span class="string">RegionServer</span> <span class="string">å †å†…å­˜çš„</span> <span class="number">40</span><span class="string">%ã€‚è¿™æ˜¯å†™ç¼“å­˜çš„æ€»æ¯”ä¾‹ï¼Œå¯ä»¥æ ¹æ®å®é™…åœºæ™¯é€‚å½“è°ƒæ•´ï¼Œä¸”è¦ä¸</span> <span class="string">HBase</span> <span class="string">è¯»ç¼“å­˜å‚æ•°</span> <span class="string">hfile.block.cache.sizeï¼ˆé»˜è®¤ä¹Ÿæ˜¯0.4ï¼‰é…åˆè°ƒæ•´ã€‚æ—§ç‰ˆæœ¬å‚æ•°åç§°ä¸º</span> <span class="string">hbase.regionserver.global.memstore.upperLimitã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span><span class="string">ã€hbase.regionserver.global.memstore.size.lower.limit</span></span><br><span class="line"></span><br><span class="line"><span class="string">é»˜è®¤å€¼</span> <span class="number">0.95</span><span class="string">ï¼Œè¡¨ç¤º</span> <span class="string">RegionServer</span> <span class="string">ä¸­æ‰€æœ‰</span> <span class="string">MemStore</span> <span class="string">å¤§å°çš„ä½æ°´ä½æ˜¯</span> <span class="string">hbase.regionserver.global.memstore.size</span> <span class="string">çš„</span> <span class="number">95</span><span class="string">%ï¼Œè¶…è¿‡è¯¥æ¯”ä¾‹å°±ä¼šå¼ºåˆ¶</span> <span class="string">Flushã€‚ä¸€èˆ¬ä¸å»ºè®®è°ƒæ•´ã€‚æ—§ç‰ˆæœ¬å‚æ•°åç§°ä¸º</span> <span class="string">hbase.regionserver.global.memstore.lowerLimitã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="number">5</span><span class="string">ã€hbase.regionserver.optionalcacheflushinterval</span></span><br><span class="line"></span><br><span class="line"><span class="string">é»˜è®¤å€¼</span> <span class="number">3600000</span><span class="string">ï¼ˆå³</span> <span class="number">1</span> <span class="string">å°æ—¶ï¼‰ï¼ŒHBase</span> <span class="string">å®šæœŸ</span> <span class="string">Flush</span> <span class="string">æ‰€æœ‰</span> <span class="string">MemStore</span> <span class="string">çš„æ—¶é—´é—´éš”ã€‚ä¸€èˆ¬å»ºè®®è°ƒå¤§ï¼Œæ¯”å¦‚</span> <span class="number">10</span> <span class="string">å°æ—¶ï¼Œå› ä¸ºå¾ˆå¤šåœºæ™¯ä¸‹</span> <span class="number">1</span> <span class="string">å°æ—¶</span> <span class="string">Flush</span> <span class="string">ä¸€æ¬¡ä¼šäº§ç”Ÿå¾ˆå¤šå°æ–‡ä»¶ï¼Œä¸€æ–¹é¢å¯¼è‡´</span> <span class="string">Flush</span> <span class="string">æ¯”è¾ƒé¢‘ç¹ï¼Œå¦ä¸€æ–¹é¢å¯¼è‡´å°æ–‡ä»¶å¾ˆå¤šï¼Œå½±å“éšæœºè¯»æ€§èƒ½ï¼Œå› æ­¤å»ºè®®è®¾ç½®è¾ƒå¤§å€¼ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="string">ä¸Šé¢å°±æ˜¯</span> <span class="string">Flush</span> <span class="string">çš„è§¦å‘æ¡ä»¶åŠæ ¸å¿ƒå‚æ•°ï¼Œç†è§£å¹¶é€‚å½“è°ƒæ•´å‚æ•°æœ‰åˆ©äºç»´æŠ¤</span> <span class="string">HBase</span> <span class="string">é›†ç¾¤çš„ç¨³å®šæ€§ã€‚</span></span><br></pre></td></tr></table></figure>

<h3 id="Compaction-ç±»å‹ã€è§¦å‘æ—¶æœºå’Œå‚æ•°"><a href="#Compaction-ç±»å‹ã€è§¦å‘æ—¶æœºå’Œå‚æ•°" class="headerlink" title="Compaction ç±»å‹ã€è§¦å‘æ—¶æœºå’Œå‚æ•°"></a>Compaction ç±»å‹ã€è§¦å‘æ—¶æœºå’Œå‚æ•°</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">ä»ä¸Šé¢åˆ†ææˆ‘ä»¬çŸ¥é“ï¼ŒHBase</span> <span class="string">ä¼šå®šæœŸæ‰§è¡Œ</span> <span class="string">Compaction</span> <span class="string">åˆå¹¶</span> <span class="string">HFileï¼Œæå‡è¯»æ€§èƒ½ï¼Œå…¶å®å°±æ˜¯ä»¥çŸ­æ—¶é—´å†…çš„ioæ¶ˆè€—ï¼Œæ¢å–ç›¸å¯¹ç¨³å®šçš„è¯»å–æ€§èƒ½ã€‚</span></span><br><span class="line"><span class="string">Compaction</span> <span class="string">ç±»å‹</span></span><br><span class="line"><span class="string">Compaction</span> <span class="string">åˆ†ä¸ºä¸¤ç§ï¼šMinor</span> <span class="string">Compaction</span> <span class="string">ä¸</span> <span class="string">Major</span> <span class="string">Compactionï¼Œå¯ä»¥ç§°ä¸ºå°åˆå¹¶ã€å¤§åˆå¹¶ï¼Œç®€å•ç¤ºæ„å›¾</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="D:\notes\cnbu.github.io\05ã€å¤§æ•°æ®\assets\15zwjw4ce3-1722932822003-7.png"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Minor</span> <span class="string">Compaction</span> <span class="string">æ˜¯æŒ‡é€‰å–ä¸€äº›å°çš„ã€ç›¸é‚»çš„</span> <span class="string">HFile</span> <span class="string">å°†ä»–ä»¬åˆå¹¶æˆä¸€ä¸ªæ›´å¤§çš„</span> <span class="string">HFileã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMinor</span> <span class="string">Compaction</span> <span class="string">ä¼šåˆ é™¤é€‰å–</span> <span class="string">HFile</span> <span class="string">ä¸­çš„</span> <span class="string">TTL</span> <span class="string">è¿‡æœŸæ•°æ®ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="string">Major</span> <span class="string">Compaction</span> <span class="string">æ˜¯æŒ‡å°†ä¸€ä¸ª</span> <span class="string">Store</span> <span class="string">ä¸­æ‰€æœ‰çš„</span> <span class="string">HFile</span> <span class="string">åˆå¹¶æˆä¸€ä¸ª</span> <span class="string">HFileï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šæ¸…ç†ä¸‰ç±»æ²¡æœ‰æ„ä¹‰çš„æ•°æ®ï¼šè¢«åˆ é™¤çš„æ•°æ®ï¼ˆæ‰“äº†</span> <span class="string">Delete</span> <span class="string">æ ‡è®°çš„æ•°æ®ï¼‰ã€TTL</span> <span class="string">è¿‡æœŸæ•°æ®ã€ç‰ˆæœ¬å·è¶…è¿‡è®¾å®šç‰ˆæœ¬å·çš„æ•°æ®ã€‚å¦å¤–ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒMajor</span> <span class="string">Compaction</span> <span class="string">æ—¶é—´ä¼šæŒç»­æ¯”è¾ƒé•¿ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¼šæ¶ˆè€—å¤§é‡ç³»ç»Ÿèµ„æºï¼Œå¯¹ä¸Šå±‚ä¸šåŠ¡æœ‰æ¯”è¾ƒå¤§çš„å½±å“ã€‚å› æ­¤ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹é€šå¸¸å…³é—­è‡ªåŠ¨è§¦å‘</span> <span class="string">Major</span> <span class="string">Compaction</span> <span class="string">åŠŸèƒ½ï¼Œæ”¹ä¸ºæ‰‹åŠ¨åœ¨ä¸šåŠ¡ä½å³°æœŸè§¦å‘ã€‚</span></span><br></pre></td></tr></table></figure>

<h3 id="Compaction-è§¦å‘æ—¶æœº"><a href="#Compaction-è§¦å‘æ—¶æœº" class="headerlink" title="Compaction è§¦å‘æ—¶æœº"></a>Compaction è§¦å‘æ—¶æœº</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ¦‚æ‹¬çš„è¯´ï¼ŒHBase ä¼šåœ¨ä¸‰ç§æƒ…å†µä¸‹æ£€æŸ¥æ˜¯å¦è¦è§¦å‘ Compactionï¼Œåˆ†åˆ«æ˜¯ MemStore Flushã€åå°çº¿ç¨‹å‘¨æœŸæ€§æ£€æŸ¥ã€æ‰‹åŠ¨è§¦å‘ã€‚</span><br><span class="line"></span><br><span class="line">MemStore Flushï¼šå¯ä»¥è¯´ Compaction çš„æ ¹æºå°±åœ¨äºFlushï¼ŒMemStore è¾¾åˆ°ä¸€å®šé˜ˆå€¼æˆ–è§¦å‘æ¡ä»¶å°±ä¼šæ‰§è¡Œ Flush æ“ä½œï¼Œåœ¨ç£ç›˜ä¸Šç”Ÿæˆ HFile æ–‡ä»¶ï¼Œæ­£æ˜¯å› ä¸º HFile æ–‡ä»¶è¶Šæ¥è¶Šå¤šæ‰éœ€è¦ Compactã€‚HBase æ¯æ¬¡Flush ä¹‹åï¼Œéƒ½ä¼šåˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œ Compactionï¼Œä¸€æ—¦æ»¡è¶³ Minor Compaction æˆ– Major Compaction çš„æ¡ä»¶ä¾¿ä¼šè§¦å‘æ‰§è¡Œã€‚</span><br><span class="line">åå°çº¿ç¨‹å‘¨æœŸæ€§æ£€æŸ¥ï¼š åå°çº¿ç¨‹ CompactionChecker ä¼šå®šæœŸæ£€æŸ¥æ˜¯å¦éœ€è¦æ‰§è¡Œ Compactionï¼Œæ£€æŸ¥å‘¨æœŸä¸º hbase.server.thread.wakefrequency * hbase.server.compactchecker.interval.multiplierï¼Œè¿™é‡Œä¸»è¦è€ƒè™‘çš„æ˜¯ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰å†™å…¥ä»ç„¶éœ€è¦åš Compact æ£€æŸ¥ã€‚å…¶ä¸­å‚æ•° hbase.server.thread.wakefrequency é»˜è®¤å€¼ 10000 å³ 10sï¼Œæ˜¯ HBase æœåŠ¡ç«¯çº¿ç¨‹å”¤é†’æ—¶é—´é—´éš”ï¼Œç”¨äº LogRollerã€MemStoreFlusher ç­‰çš„å‘¨æœŸæ€§æ£€æŸ¥ï¼›å‚æ•° hbase.server.compactchecker.interval.multiplier é»˜è®¤å€¼1000ï¼Œæ˜¯ Compaction æ“ä½œå‘¨æœŸæ€§æ£€æŸ¥ä¹˜æ•°å› å­ï¼Œ10 * 1000 s æ—¶é—´ä¸Šçº¦ç­‰äº2hrs, 46mins, 40secã€‚</span><br><span class="line">æ‰‹åŠ¨è§¦å‘ï¼šé€šè¿‡ HBase Shellã€Master UI ç•Œé¢æˆ– HBase API ç­‰ä»»ä¸€ç§æ–¹å¼æ‰§è¡Œ compactã€major_compactç­‰å‘½ä»¤ï¼Œä¼šç«‹å³è§¦å‘ Compactionã€‚</span><br></pre></td></tr></table></figure>

<h3 id="Compaction-æ ¸å¿ƒå‚æ•°"><a href="#Compaction-æ ¸å¿ƒå‚æ•°" class="headerlink" title="Compaction æ ¸å¿ƒå‚æ•°"></a>Compaction æ ¸å¿ƒå‚æ•°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> Compaction æœ‰å…³çš„é‡è¦å‚æ•°ï¼Œå¹¶ç»™å‡ºè°ƒæ•´å»ºè®®ï¼š</span><br><span class="line"></span><br><span class="line">1ã€hbase.hstore.compaction.min</span><br><span class="line">é»˜è®¤å€¼ 3ï¼Œä¸€ä¸ª Store ä¸­ HFile æ–‡ä»¶æ•°é‡è¶…è¿‡è¯¥é˜ˆå€¼å°±ä¼šè§¦å‘ä¸€æ¬¡ Compactionï¼ˆMinor Compactionï¼‰ï¼Œè¿™é‡Œç§°è¯¥å‚æ•°ä¸º minFilesToCompactã€‚ä¸€èˆ¬ä¸å»ºè®®è°ƒå°ï¼Œé‡å†™åœºæ™¯ä¸‹å¯ä»¥è°ƒå¤§è¯¥å‚æ•°ï¼Œæ¯”å¦‚ 5~10 ä¹‹é—´ï¼Œæ³¨æ„ç›¸åº”è°ƒæ•´ä¸‹ä¸€ä¸ªå‚æ•°ã€‚è€ç‰ˆæœ¬å‚æ•°åç§°ä¸º hbase.hstore.compactionthresholdã€‚</span><br><span class="line"></span><br><span class="line">2ã€hbase.hstore.compaction.max</span><br><span class="line">é»˜è®¤å€¼ 10ï¼Œä¸€æ¬¡ Minor Compaction æœ€å¤šåˆå¹¶çš„ HFile æ–‡ä»¶æ•°é‡ï¼Œè¿™é‡Œç§°è¯¥å‚æ•°ä¸º maxFilesToCompactã€‚è¿™ä¸ªå‚æ•°ä¹Ÿæ§åˆ¶ç€ä¸€æ¬¡å‹ç¼©çš„è€—æ—¶ã€‚ä¸€èˆ¬ä¸å»ºè®®è°ƒæ•´ï¼Œä½†å¦‚æœä¸Šä¸€ä¸ªå‚æ•°è°ƒæ•´äº†ï¼Œè¯¥å‚æ•°ä¹Ÿåº”è¯¥ç›¸åº”è°ƒæ•´ï¼Œä¸€èˆ¬è®¾ä¸º minFilesToCompact çš„ 2~3 å€ã€‚</span><br><span class="line"></span><br><span class="line">3ã€hbase.regionserver.thread.compaction.throttle</span><br><span class="line">HBase RegionServer å†…éƒ¨è®¾è®¡äº†ä¸¤ä¸ªçº¿ç¨‹æ±  large compactions ä¸ small compactionsï¼Œç”¨æ¥åˆ†ç¦»å¤„ç† Compaction æ“ä½œï¼Œè¯¥å‚æ•°å°±æ˜¯æ§åˆ¶ä¸€ä¸ª Compaction äº¤ç”±å“ªä¸€ä¸ªçº¿ç¨‹æ± å¤„ç†ï¼Œé»˜è®¤å€¼æ˜¯ 2 * maxFilesToCompact * hbase.hregion.memstore.flush.sizeï¼ˆé»˜è®¤2*10*128M=2560Må³2.5Gï¼‰ï¼Œå»ºè®®ä¸è°ƒæ•´æˆ–ç¨å¾®è°ƒå¤§ã€‚</span><br><span class="line"></span><br><span class="line">4ã€hbase.regionserver.thread.compaction.large/small</span><br><span class="line">é»˜è®¤å€¼ 1ï¼Œè¡¨ç¤º large compactions ä¸ small compactions çº¿ç¨‹æ± çš„å¤§å°ã€‚ä¸€èˆ¬å»ºè®®è°ƒæ•´åˆ° 2~5ï¼Œä¸å»ºè®®å†è°ƒå¤ªå¤§æ¯”å¦‚10ï¼Œå¦åˆ™å¯èƒ½ä¼šæ¶ˆè´¹è¿‡å¤šçš„æœåŠ¡ç«¯èµ„æºé€ æˆä¸è‰¯å½±å“ã€‚</span><br><span class="line"></span><br><span class="line">5ã€hbase.hstore.blockingStoreFiles</span><br><span class="line">é»˜è®¤å€¼ 10ï¼Œè¡¨ç¤ºä¸€ä¸ª Store ä¸­ HFile æ–‡ä»¶æ•°é‡è¾¾åˆ°è¯¥å€¼å°±ä¼šé˜»å¡å†™å…¥ï¼Œç­‰å¾… Compaction çš„å®Œæˆã€‚ä¸€èˆ¬å»ºè®®è°ƒå¤§ç‚¹ï¼Œæ¯”å¦‚è®¾ç½®ä¸º 100ï¼Œé¿å…å‡ºç°é˜»å¡æ›´æ–°çš„æƒ…å†µï¼Œé˜»å¡æ—¥å¿—å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">too many store files; delaying flush up to 90000ms</span><br><span class="line">ç”Ÿäº§ç¯å¢ƒå»ºè®®è®¤çœŸæ ¹æ®å®é™…ä¸šåŠ¡é‡åšå¥½é›†ç¾¤è§„æ¨¡è¯„ä¼°ï¼Œå¦‚æœå°é›†ç¾¤é‡åˆ°äº†æŒç»­å†™å…¥è¿‡å¿«çš„åœºæ™¯ï¼Œåˆç†æ‰©å±•é›†ç¾¤ä¹Ÿéå¸¸é‡è¦ã€‚</span><br><span class="line"></span><br><span class="line">6ã€hbase.hregion.majorcompaction</span><br><span class="line">é»˜è®¤å€¼ 604800000 ms å³7å¤©ï¼Œè¿™æ˜¯ Major Compaction å‘¨æœŸæ€§è§¦å‘æ‰§è¡Œçš„æ—¶é—´é—´éš”ã€‚é€šå¸¸ Major Compaction æŒç»­æ—¶é—´è¾ƒé•¿ã€èµ„æºæ¶ˆè€—è¾ƒå¤§ï¼Œä¸€èˆ¬è®¾ä¸º 0ï¼Œè¡¨ç¤ºå…³é—­è‡ªåŠ¨è§¦å‘ï¼Œå»ºè®®åœ¨ä¸šåŠ¡ä½å³°æœŸæ—¶æ‰‹åŠ¨æ‰§è¡Œã€‚</span><br></pre></td></tr></table></figure>



<h2 id="hbase-master-æ—¥å¿—æ¸…ç†"><a href="#hbase-master-æ—¥å¿—æ¸…ç†" class="headerlink" title="hbase master æ—¥å¿—æ¸…ç†"></a>hbase master æ—¥å¿—æ¸…ç†</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç›®å‰é»˜è®¤é…ç½®çš„æ¸…é™¤å™¨æ’ä»¶æœ‰ReplicationLogCleanerã€SnapshotLogCleanerå’ŒTimeToLiveLogCleanerè¿™ä¸‰ç§ï¼š</span><br><span class="line"></span><br><span class="line">ReplicationLogCleaner:å¦‚æœæœ‰è·¨é›†ç¾¤æ•°æ®åŒæ­¥çš„éœ€æ±‚ï¼Œé€šè¿‡è¯¥Cleaneræ¥ä¿è¯é‚£äº›åœ¨åŒæ­¥ä¸­çš„æ—¥å¿—ä¸è¢«åˆ é™¤ï¼›</span><br><span class="line">SnapshotLogCleaner:è¢«è¡¨çš„snapshotä½¿ç”¨åˆ°äº†çš„walä¸è¢«åˆ é™¤ï¼›</span><br><span class="line">TimeToLiveLogCleaner:æ—¥å¿—æ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´åœ¨é…ç½®å‚æ•°&#123;hbase.master.logcleaner.ttlé»˜è®¤600ç§’&#125;ä¹‹å‰çš„å¯ä»¥åˆ é™¤ã€‚</span><br></pre></td></tr></table></figure>



<h2 id="HDFSï¼ˆhdfs-site-xmlï¼‰ç›¸å…³è°ƒæ•´"><a href="#HDFSï¼ˆhdfs-site-xmlï¼‰ç›¸å…³è°ƒæ•´" class="headerlink" title="HDFSï¼ˆhdfs-site.xmlï¼‰ç›¸å…³è°ƒæ•´"></a>HDFSï¼ˆhdfs-site.xmlï¼‰ç›¸å…³è°ƒæ•´</h2><ul>
<li>dfs.datanode.synconclose &#x3D; true</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dfs.datanode.synconclose set to false in hdfs-site.xml: data loss is possible on hard system reset or power loss</span><br></pre></td></tr></table></figure>

<ul>
<li>mount ext4 with dirsync! Or use XFS</li>
<li>dfs.datanode.sync.behind.writes &#x3D; true (default false)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è®¾ç½®ä¸ºtrueï¼Œåœ¨æ•°æ®å†™å…¥å®Œæˆä¹‹åï¼Œdatanodeä¼šè¦æ±‚æ“ä½œç³»ç»Ÿå°†æ•°æ®ç›´æ¥åŒæ­¥åˆ°ç£ç›˜</span><br></pre></td></tr></table></figure>

<ul>
<li>dfs.namenode.avoid.read.stale.datanode &#x3D; true (default false)</li>
<li>dfs.namenode.avoid.write.stale.datanode &#x3D; true (default false)</li>
<li>dfs.namenode.stale.datanode.interval &#x3D; 30000 (default 30000)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é¿å…è¯»å†™declared deadçš„datanodeï¼Œdatanodeä¼šå‘é€å¿ƒè·³ç»™namenode,å¦‚æœè¶…è¿‡äº†dfs.namenode.stale.datanode.intervalçš„æ—¶é—´è¿˜æœªæ¥æ”¶åˆ°datanodeçš„å¿ƒè·³ï¼Œåˆ™è®¤ä¸ºè¯¥datanodeä¸ºstaleçŠ¶æ€ï¼Œä¹Ÿå°±ä¼šå°†datanode declareæˆdeadã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œnamenodeä»ç„¶ä¼šå¯¹staleçŠ¶æ€çš„datanodeè¯»</span><br></pre></td></tr></table></figure>

<ul>
<li>dfs.datanode.failed.volumes.tolerated &#x3D; <N></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keep DN running with some failed disks,tolerate losing this many disksï¼Œæ ¹æ®ç£ç›˜å®é™…é…ç½®æ•°é‡è°ƒæ•´</span><br></pre></td></tr></table></figure>

<ul>
<li>dfs.client.read.shortcircuit &#x3D; true</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¯ç”¨çŸ­è·¯å¾„è¯»å–(short-circuit)ï¼š</span><br><span class="line">å½“clientè¯·æ±‚æ•°æ®æ—¶ï¼Œdatanodeä¼šè¯»å–æ•°æ®ç„¶åé€šè¿‡TCPåè®®å‘é€ç»™clientï¼Œshort-circuitç»•è¿‡äº†datanodeç›´æ¥è¯»å–æ•°æ®ã€‚</span><br><span class="line">short-circuitçš„å‰ææ˜¯clientå’Œæ•°æ®åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ‰€ä»¥é›†ç¾¤hbase regionserverå’Œhdfs datanodeçš„æ•°é‡ä¸Šä¸€èˆ¬éƒ½æ˜¯1:1ï¼Œå¹¶ä¸”datanodeå’Œregionserverå…±å¤„ä¸€ä¸ªèŠ‚ç‚¹ã€‚</span><br><span class="line">é™¤æ­¤ä¹‹åï¼ŒæŒ‡æ ‡Localityï¼ˆæ•°æ®æœ¬åœ°æ€§ï¼‰éœ€è¦é¢å¤–å…³æ³¨ï¼Œå› ä¸ºæ›´é«˜çš„æ•°æ®æœ¬åœ°æ€§ï¼Œå¯ä»¥ä½¿çŸ­è·¯å¾„å‘æŒ¥æ›´å¥½çš„æ€§èƒ½</span><br></pre></td></tr></table></figure>

<ul>
<li>dfs.datanode.max.transfer.threads &#x3D; 8192 (default 4096)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Specifies the maximum number of threads to use for transferring data in and out of the DN.</span><br><span class="line">An HDFS DataNode has an upper bound on the number of files that it will serve at any one timeè¯¦è§ï¼šhttps://hbase.apache.org/book.html#dfs.datanode.max.transfer.threadshttp://www.larsgeorge.com/2012/03/hadoop-hbase-and-xceivers.html</span><br></pre></td></tr></table></figure>

<ul>
<li>dfs.namenode.handler.count &#x3D; 64 (default 10)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The number of Namenode RPC server threads that listen to requests from clients. If dfs.namenode.servicerpc-address is not configured then Namenode RPC server threads listen to requests from all nodes.</span><br></pre></td></tr></table></figure>

<ul>
<li>dfs.datanode.handler.count &#x3D; 8 (default 10)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The number of server threads for the datanode.</span><br></pre></td></tr></table></figure>

<h2 id="HBaseï¼ˆhbase-site-xmlï¼‰ç›¸å…³è°ƒæ•´"><a href="#HBaseï¼ˆhbase-site-xmlï¼‰ç›¸å…³è°ƒæ•´" class="headerlink" title="HBaseï¼ˆhbase-site.xmlï¼‰ç›¸å…³è°ƒæ•´"></a>HBaseï¼ˆhbase-site.xmlï¼‰ç›¸å…³è°ƒæ•´</h2><ul>
<li>hbase.hstore.blockingStoreFiles &#x3D; 100</li>
<li>hbase.hregion.memstore.block.multiplier &#x3D; 4</li>
<li>hbase.hregion.memstore.flush.size &#x3D; 128</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœstorefileçš„æ•°é‡è¶…è¿‡äº†10ä¸ªï¼Œå°±ä¼šé˜»å¡flushï¼Œcompactçº¿ç¨‹è¿›è¡Œåˆå¹¶ï¼ˆå¦‚æœè§‚å¯Ÿæ—¥å¿—ï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼&quot;Too many HFiles, delaying flush&quot;ä¹‹ç±»çš„è¾“å‡ºï¼‰ï¼Œå¦‚æœæƒ³è®©æ•°æ®å†™å…¥æ›´åŠ å¹³æ»‘æˆ–è€…ä¸šåŠ¡å†™å…¥é‡å·¨å¤§ï¼Œå¯ä»¥è€ƒè™‘å¢å¤§è¯¥å€¼ã€‚</span><br><span class="line">å¦å¤–ï¼Œåœ¨è¾¾åˆ°äº†blockingStoreFilesé˜€å€¼çš„æ—¶å€™ï¼Œå¼€å§‹é˜»å¡flushï¼Œé‚£ä¹ˆmemstoreå°±ä¼šè†¨èƒ€ï¼Œå½“memstoreè†¨èƒ€åˆ° flush size ä¹˜äº multiplierï¼ˆflush size X multiplierï¼‰çš„æ—¶å€™ï¼Œè¿™ä¸ªåˆ—ç°‡çš„</span><br><span class="line">å†™æ“ä½œå°±ä¼šè¢«é˜»å¡ï¼Œä¸€ç›´åˆ°flushå®Œæˆï¼ˆå¯ä»¥å…³æ³¨æ—¥å¿—ï¼Œä¼šæœ‰ç›¸å…³æ—¥å¿—è¾“å‡ºï¼‰ã€‚</span><br><span class="line">æ‰€ä»¥å¦‚æœå†™å…¥é‡å·¨å¤§ï¼Œå»ºè®®åŒæ—¶å¢åŠ multiplierå¤§å°ï¼Œè‡³äºflush sizeçš„å¤§å°ï¼Œä¸€èˆ¬é»˜è®¤å³å¯</span><br></pre></td></tr></table></figure>

<ul>
<li>hbase.regionserver.handler.count &#x3D; 30</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ¯ä¸ªregionserverå¯åŠ¨çš„RPC Listenerå®ä¾‹ä¸ªæ•°ï¼Œhbase.master.handler.countå‚æ•°æ„æ€è·Ÿå®ƒåŸºæœ¬ä¸€æ ·ã€‚handlerä¸ªæ•°å¹¶éè¶Šå¤šè¶Šå¥½ï¼Œå¦‚æœè®¾ç½®äº†è¿‡å¤šçš„handlerå¯èƒ½å¾—åˆ°ä¸€ä¸ªé€‚å¾—å…¶åçš„ç»“æœ</span><br><span class="line">å¦‚æœæ˜¯read-onlyçš„åœºæ™¯ï¼Œhandlerçš„ä¸ªæ•°æ¥è¿‘ä¸cpuä¸ªæ•°æ¯”è¾ƒå¥½ã€‚åœ¨è°ƒæ•´è¯¥å‚æ•°æ—¶å€™ï¼Œå»ºè®®è®¾ç½®ä¸ºcpuä¸ªæ•°çš„å€æ•°ï¼Œä»ä¸¤å€cpuä¸ªæ•°å¼€å§‹è°ƒæ•´ã€‚</span><br></pre></td></tr></table></figure>

<ul>
<li>hbase.hregion.max.filesize &#x3D; 10G</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ§åˆ¶region splitçš„é˜€å€¼ï¼Œéœ€è¦æ³¨æ„ï¼šå¦‚æœæœ‰å¤šä¸ªåˆ—ç°‡ï¼Œä¸ç®¡å“ªä¸ªåˆ—ç°‡è¾¾åˆ°äº†è¯¥å€¼ï¼Œå°±ä¼šè§¦å‘splitï¼Œå¹¶ä¸”æ˜¯regionçº§åˆ«çš„ï¼Œå“ªæ€•å…¶ä»–çš„åˆ—ç°‡çš„hfileå€¼è¿˜å¾ˆå°</span><br><span class="line">ç›®å‰æ¥è¯´ï¼Œæ¨èçš„æœ€å¤§region sizeä¸º10-20Gï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è®¾ç½®çš„æ›´å¤§ï¼Œæ¯”å¦‚50Gï¼ˆå¦‚æœè®¾ç½®äº†å‹ç¼©ï¼Œè¯¥å€¼æŒ‡çš„æ˜¯å‹ç¼©ä¹‹åçš„å¤§å°ï¼‰</span><br></pre></td></tr></table></figure>

<ul>
<li>hbase.regionserver.region.split.policy &#x3D; SteppingSplitPolicy</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">splitç®—æ³•æœ‰å¤šç§ï¼Œä¸ä¸€ä¸€ä»‹ç»äº†ã€‚é»˜è®¤æ˜¯SteppingSplitPolicyç®—æ³•ï¼Œå¯ä»¥æ ¹æ®å®é™…åœºæ™¯æƒ…å†µé€‰æ‹©æ›´ä¸ºåˆé€‚çš„ï¼Œæ¯”å¦‚å¯¹äºå·²çŸ¥æ•°æ®å¤§å°çš„å†å²æ•°æ®ï¼Œå¯ä»¥å°†è¡¨çš„splitç®—æ³•è®¾ç½®ä¸ºorg.apache.hadoop.hbase.regionserver.ConstantSizeRegionSplitPolicyï¼Œä»¥å®ç°æ›´å¥½çš„æ§åˆ¶regionæ•°ç›®</span><br></pre></td></tr></table></figure>

<ul>
<li>zookeeper.session.timeout &#x3D; 90000(default,in milliseconds)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">regionserverä¸zookeeperå»ºç«‹sessionï¼Œzookeeperé€šè¿‡sessionæ¥ç¡®è®¤regionserverçš„çŠ¶æ€ï¼Œæ¯ä¸ªregionserveråœ¨zookeeperä¸­éƒ½æœ‰è‡ªå·±çš„ä¸´æ—¶znodeã€‚å¦‚æœå»ºç«‹çš„sessionæ–­å¼€äº†æˆ–è€…è¶…æ—¶äº†ï¼ˆæ¯”å¦‚gcæˆ–è€…ç½‘ç»œé—®é¢˜ï¼‰ï¼Œé‚£ä¹ˆzkä¸­çš„è¿™ä¸ªregionserverçš„ä¸´æ—¶znodeå°†è¢«åˆ é™¤ï¼Œå¹¶ä¸”è¯¥regionserveræ ‡è®°ä¸ºcrashedã€‚</span><br><span class="line"></span><br><span class="line">1.åœ¨è®¾ç½®è¯¥å‚æ•°å€¼éœ€è¦æ³¨æ„ï¼Œè¦å…³æ³¨zookeeper serverçš„Minimum session timeoutå’ŒMaximum session timeoutï¼Œzookeeperé»˜è®¤Minimum session timeout ä¸º 2 X tick timeï¼ŒMaximum session timeout ä¸º 20 x tick timeï¼Œtick timeä¸ºå¿ƒè·³é—´éš”ï¼ˆé»˜è®¤2ç§’ï¼‰ã€‚</span><br><span class="line">ä¹Ÿå°±æ˜¯è¯´ä½ åœ¨hbaseä¾§è®¾ç½®çš„æœ€å¤§ä¼šè¯è¶…æ—¶æ—¶é—´åœ¨æ˜¯ä»¥clientçš„èº«ä»½è®¾ç½®çš„ï¼Œæ‰€ä»¥æœ€ç»ˆè¿˜æ˜¯ä»¥zookeeper serverä¸ºä¸»ã€‚ï¼ˆåœ¨cdhé›†ç¾¤ä¸­ï¼Œå¦‚æœhbaseçš„è¯¥å‚æ•°å€¼å¤§äºzk serverçš„æœ€å¤§ä¼šè¯è¶…æ—¶æ—¶é—´ï¼Œä¼šæç¤ºä½ ä¿®æ”¹ï¼‰,æ¯”å¦‚ä½ åœ¨hbaseä¾§è®¾ç½®æœ€å¤§è¶…æ—¶æ—¶é—´ä¸º90s,ä½†æ˜¯zkçš„æœ€å¤§è¶…æ—¶æ—¶é—´æ˜¯40sï¼Œé‚£ä¹ˆæœ€ç»ˆè¿˜æ˜¯å¦‚æœè¶…è¿‡40sä¾¿è§†ä¸ºè¶…æ—¶ã€‚</span><br><span class="line"></span><br><span class="line">2.å¦‚æœæƒ³å¢åŠ hbaseè¶…æ—¶æ—¶é—´é™åˆ¶ï¼Œå¯ä»¥æé«˜tick timeçš„å€¼ï¼Œä½†æ˜¯å»ºè®®ä¸è¦è¶…è¿‡5ç§’ï¼Œè¶…è¿‡5ç§’ä¸åˆ©äºzookeeperé›†ç¾¤çš„æ­£å¸¸è¿è¡Œ</span><br><span class="line"></span><br><span class="line">3.å¯¹äºé‚£ç§failing quickly is better than waitingçš„åº”ç”¨ï¼Œå¯ä»¥å°†è¶…æ—¶æ—¶é—´é™å®šå°ä¸€äº›ï¼ˆå»ºè®®å€¼20ç§’-30ç§’ï¼‰ï¼Œä½†æ˜¯åœ¨æ­¤ä¹‹å‰ï¼Œä½ éœ€è¦å¯¹GCçš„æ—¶é—´æœ‰ä¸€ä¸ªè‰¯å¥½çš„æ§åˆ¶ã€‚å¦åˆ™ä¼šå› ä¸ºGCå¯¼è‡´regionserveré¢‘ç¹è¢«æ ‡è®°ä¸ºcrashed</span><br></pre></td></tr></table></figure>

<ul>
<li>hbase.regionserver.thread.compaction.small &#x3D; 1 (default)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç”¨äºminor compactçš„çº¿ç¨‹æ•°ï¼Œå½“compact queneæ¯”è¾ƒé«˜çš„æ—¶å€™ï¼Œå»ºè®®å¢åŠ è¯¥å€¼ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¯¥çº¿ç¨‹æ•°æ°¸è¿œä¸è¦è¶…è¿‡ä½ å¯ç”¨ç£ç›˜æ•°ç›®çš„ä¸€åŠã€‚</span><br><span class="line">æ¯”å¦‚ï¼šä½ æœ‰8å—SSDs, è¯¥å€¼ä¸è¦è¶…è¿‡4</span><br><span class="line"></span><br><span class="line">åŒç†hbase.hstore.flusher.count</span><br></pre></td></tr></table></figure>

<ul>
<li>hbase.hregion.majorcompaction &#x3D; 0</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">major compactæ—¶é—´å‘¨æœŸï¼Œé»˜è®¤ä¸ƒå¤©ï¼Œä½†æ˜¯è§¦å‘æ—¶é—´ç‚¹å¾€å¾€éƒ½ä¸æ˜¯æœ€ä½³çš„ã€‚æ‰€ä»¥ä¸€èˆ¬çº¿ä¸Šç¯å¢ƒéƒ½ç¦ç”¨major compactï¼Œç„¶ååœ¨åˆé€‚çš„æ—¶é—´æ‰‹åŠ¨æ‰§è¡Œ</span><br></pre></td></tr></table></figure>

<ul>
<li>hbase.regionserver.hlog.blocksize &#x3D; 128M (default)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é»˜è®¤å³å¯ï¼Œä½†æ˜¯éœ€è¦äº†è§£çš„æ˜¯WALä¸€èˆ¬åœ¨è¾¾åˆ°è¯¥å€¼çš„95%çš„æ—¶å€™å°±ä¼šæ»šåŠ¨</span><br></pre></td></tr></table></figure>

<ul>
<li>hbase.regionserver.maxlogs &#x3D; 32 (default)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">é…ç½®WAL Filesçš„æ•°é‡ï¼Œ(WAL:to recover memstore data not yet flushed to disk if a RegionServer crashes)ï¼ŒWAL filesè¿‡å°‘çš„è¯ï¼Œä¼šè§¦å‘æ›´å¤šçš„flush,å¤ªå¤šçš„è¯ï¼Œhbase recoveryæ—¶é—´ä¼šæ¯”è¾ƒé•¿ã€‚</span><br><span class="line"></span><br><span class="line">æ ¹æ®ä¸åŒçš„regionserverå †å¤§å°è®¾ç½®ä¸åŒæ•°é‡çš„WALã€‚æœ‰ä¸€ä¸ªç»éªŒå…¬å¼ï¼š</span><br><span class="line">(regionserver_heap_size * memstore fraction) / (default_WAL_size)</span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚ï¼ŒHBaseé›†ç¾¤é…ç½®å¦‚ä¸‹:</span><br><span class="line">    â€¢ 16 GB RegionServer heap</span><br><span class="line">    â€¢ 0.4 memstore fraction</span><br><span class="line">    â€¢ 120 MB default WAL size</span><br><span class="line">The formula for this configuration looks as follows:</span><br><span class="line">(16384 MB * 0.4 / 120 MB = approximately 55 WAL files</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šå¦‚æœrecoveryçš„æ—¶é—´è¿‡é•¿ï¼Œå¯ä»¥å‡å°ä¸Šé¢è®¡ç®—çš„å€¼</span><br></pre></td></tr></table></figure>

<ul>
<li>hbase.wal.provider &#x3D; mutiwal</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªregionserveråªæœ‰ä¸€ä¸ªwalæ–‡ä»¶ï¼Œæ‰€æœ‰regionçš„walEntryéƒ½å†™åˆ°è¿™ä¸ªwalæ–‡ä»¶ä¸­ï¼Œåœ¨HBase-5699ä¹‹åï¼Œä¸€ä¸ªregionserverå¯ä»¥é…ç½®å¤šä¸ªwalæ–‡ä»¶ï¼Œè¿™æ ·å¯ä»¥æé«˜å†™WALæ—¶çš„ååï¼Œè¿›è€Œé™ä½æ•°æ®å†™å»¶æ—¶ï¼Œå…¶ä¸­é…ç½®hbase.wal.regiongrouping.strategyå†³å®šäº†æ¯ä¸ªregionå†™å…¥walæ—¶çš„åˆ†ç»„ç­–ç•¥ï¼Œé»˜è®¤æ˜¯boundedï¼Œè¡¨ç¤ºæ¯ä¸ªregiongroupå†™å…¥å›ºå®šæ•°é‡ä¸ªwalï¼›</span><br><span class="line"></span><br><span class="line">Multiple Wal:HBASE-5669(available in hbase 1.0.0+)</span><br><span class="line"></span><br><span class="line">1.ç‰ˆæœ¬ä½äº1.2.0 replicationå­˜åœ¨é—®é¢˜</span><br><span class="line">2.å†™å…¥æ€§èƒ½è¾ƒå•WALæå‡20%</span><br><span class="line">3.hbase.wal.regiongrouping.strategy = boundedï¼ˆåˆ†ç»„ç­–ç•¥ï¼‰</span><br><span class="line">4.hbase.wal.regiongrouping.numgroups = 2(æ ¹æ®ç›˜æ•°è®¾ç½®)</span><br><span class="line">æ³¨æ„ï¼šhbase.regionserver.maxlogsï¼Œå†³å®šäº†ä¸€ä¸ªregionserverä¸­walæ–‡ä»¶çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤æ˜¯32ï¼Œåœ¨ä¸Šè¿°é…ç½®ä¸‹ï¼Œå¦‚æœä»æ—§è®¾ç½®ä¿æŒ32ï¼Œç­‰ä»·äºä¸ä½¿ç”¨multiwalæ—¶çš„64ï¼›</span><br></pre></td></tr></table></figure>

<h2 id="HBaseè¡¨å±æ€§è°ƒæ•´"><a href="#HBaseè¡¨å±æ€§è°ƒæ•´" class="headerlink" title="HBaseè¡¨å±æ€§è°ƒæ•´"></a>HBaseè¡¨å±æ€§è°ƒæ•´</h2><h3 id="Compression"><a href="#Compression" class="headerlink" title="Compression"></a>Compression</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.å¯ä»¥é€‰æ‹©çš„æœ‰NONE, GZIP, SNAPPY, ç­‰ç­‰</span><br><span class="line">2.æŒ‡å®šå‹ç¼©æ–¹å¼ï¼šcreate â€™test&#x27;, &#123;NAME =&gt; â€™cf&#x27;, COMPRESSION =&gt; &#x27;SNAPPYâ€™&#125;&#125;</span><br><span class="line">3.èŠ‚çœç£ç›˜ç©ºé—´</span><br><span class="line">4.å‹ç¼©é’ˆå¯¹çš„æ˜¯æ•´ä¸ªå—ï¼Œå¯¹getæˆ–scanä¸å¤ªå‹å¥½</span><br><span class="line">5.ç¼“å­˜å—çš„æ—¶å€™ä¸ä¼šä½¿ç”¨å‹ç¼©ï¼Œé™¤éæŒ‡å®šhbase.block.data.cachecompressed = trueï¼Œè¿™æ ·å¯ä»¥ç¼“å­˜æ›´å¤šçš„å—ï¼Œä½†æ˜¯è¯»å–æ•°æ®æ—¶å€™ï¼Œéœ€è¦è¿›è¡Œè§£å‹ç¼©</span><br></pre></td></tr></table></figure>

<h3 id="HFile-Block-Size"><a href="#HFile-Block-Size" class="headerlink" title="HFile Block Size"></a>HFile Block Size</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. ä¸ç­‰åŒäºHDFS block size</span><br><span class="line">2. æŒ‡å®šBLOCKSIZEå±æ€§</span><br><span class="line">    create â€˜testâ€²,&#123;NAME =&gt; â€˜cfâ€², BLOCKSIZE =&gt; â€™4096&#x27;&#125;</span><br><span class="line">3.é»˜è®¤64KB,å¯¹Scanå’ŒGetç­‰åŒçš„åœºæ™¯æ¯”è¾ƒå‹å¥½</span><br><span class="line">4.å¢åŠ è¯¥å€¼æœ‰åˆ©äºscan</span><br><span class="line">5.å‡å°è¯¥å€¼æœ‰åˆ©äºget</span><br></pre></td></tr></table></figure>

<h2 id="RegionServerèŠ‚ç‚¹ç¡¬ä»¶é…ç½®"><a href="#RegionServerèŠ‚ç‚¹ç¡¬ä»¶é…ç½®" class="headerlink" title="RegionServerèŠ‚ç‚¹ç¡¬ä»¶é…ç½®"></a>RegionServerèŠ‚ç‚¹ç¡¬ä»¶é…ç½®</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å¤§å¤šæ—¶å€™ï¼Œå¯¹äºhbaseé›†ç¾¤æˆ‘ä»¬ä¼šé¢ä¸´è¿™æ ·çš„é—®é¢˜ï¼š</span><br><span class="line">    â€¢ åº”è¯¥åˆ†é…å¤šå°‘çš„RAM/heap?</span><br><span class="line">    â€¢ åº”è¯¥å‡†å¤‡å¤šå°‘å—ç£ç›˜ï¼Ÿ</span><br><span class="line">    â€¢ ç£ç›˜çš„å¤§å°åº”è¯¥å¤šå¤§ï¼Ÿ</span><br><span class="line">    â€¢ ç½‘å¡å¸¦å®½ï¼Ÿ</span><br><span class="line">    â€¢ åº”è¯¥æœ‰å¤šå°‘ä¸ªcpu core?</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">regionserverçš„ç£ç›˜å¤§å°ä¸å †å¤§å°æ˜¯æœ‰ä¸€ä¸ªæ¯”ä¾‹çš„ï¼š</span><br><span class="line">Disk/Heap ratio:</span><br><span class="line">RegionSize / MemstoreSize *ReplicationFactor *HeapFractionForMemstores * 2</span><br><span class="line"> </span><br><span class="line">é‚£ä¹ˆåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ¯”ä¾‹ç­‰äºï¼š10gb/128mb * 3 * 0.4 * 2 = 192</span><br><span class="line"></span><br><span class="line">ä¹Ÿå°±æ˜¯è¯´ï¼š</span><br><span class="line">åœ¨ç£ç›˜ä¸Šæ¯å­˜å‚¨192å­—èŠ‚çš„æ•°æ®ï¼Œå¯¹åº”å †çš„å¤§å°åº”ä¸º1å­—èŠ‚</span><br><span class="line">é‚£ä¹ˆå¦‚æœè®¾ç½®32Gçš„å †ï¼Œç£ç›˜ä¸Šä¹Ÿå°±æ˜¯å¯ä»¥å­˜å‚¨å¤§æ¦‚6TBçš„æ•°æ®(32gb * 192 = 6tb)</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ç†æƒ³çŠ¶å†µä¸‹regionserverçš„ç¡¬ä»¶é…ç½®ï¼š</span><br><span class="line">    1.æ¯ä¸ªèŠ‚ç‚¹&lt;=6TBçš„ç£ç›˜ç©ºé—´</span><br><span class="line">    2.regionserver heap çº¦ç­‰äºç£ç›˜å¤§å°/200ï¼ˆä¸Šé¢çš„æ¯”ä¾‹å…¬å¼ï¼‰</span><br><span class="line">    3.ç”±äºhbaseå±äºcpuå¯†é›†å‹ï¼Œæ‰€ä»¥è¾ƒå¤šçš„cpu coreæ•°é‡æ›´é€‚åˆ</span><br><span class="line">    4.ç½‘å¡å¸¦å®½å’Œç£ç›˜ååé‡çš„åŒ¹é…å€¼ï¼š</span><br><span class="line">            ï¼ˆèƒŒæ™¯ï¼šç£ç›˜ä½¿ç”¨ä¼ ç»ŸHDDï¼ŒI/O 100M/sï¼‰</span><br><span class="line">        CASE1ï¼š1GEçš„ç½‘å¡ï¼Œé…å¤‡24å—ç£ç›˜ï¼Œåƒè¿™æ ·çš„æ­é…æ˜¯ä¸å¤ªç†æƒ³çš„ï¼Œå› ä¸º1GEçš„ç½‘å¡æµé‡ç­‰äº125M/sï¼Œè€Œ24å—ç£ç›˜çš„ååé‡å¤§æ¦‚2.4GB/sï¼Œç½‘å¡æˆä¸ºç“¶é¢ˆ</span><br><span class="line">        CASE2ï¼š10GEçš„ç½‘å¡ï¼Œé…å¤‡24å—ç£ç›˜ï¼Œæ¯”è¾ƒç†æƒ³</span><br><span class="line">        CASE3ï¼š1GEçš„ç½‘å¡ï¼Œé…ç½®4-6å—ç£ç›˜ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒç†æƒ³çš„</span><br></pre></td></tr></table></figure>

      
       <hr><span style="font-style: italic;color: gray;"> è½¬è½½è¯·æ³¨æ˜æ¥æºï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºåŒºè¯„è®ºï¼Œä¹Ÿå¯ä»¥é‚®ä»¶è‡³ jaytp@qq.com </span>
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">ğŸ’°</a>
</p>






    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    Â©2016-2020 Yelog
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="Toggle full screen shortcut key s"><span class="min mobile"></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">Ã—</a>
    <div class="shang_tit">
        <p>Help us with donation</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="æ‰«ç æ”¯æŒ">
            <img src="/img/weixin.jpg" class="weixin" title="æ‰«ç æ”¯æŒ">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">alipay</label></span><span><label><input type="radio" name="pay" value="weixin">weixin</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ ·å¼*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*æ¸²æŸ“æ‰“èµæ ·å¼*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*é«˜äº®ä»£ç å—è¡Œå·*/
        

        /*è®¿é—®æ•°é‡*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*ä»£ç é«˜äº®ï¼Œè¡Œå·å¯¹é½*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*æ‰“èµé¡µé¢éšè—ä¸å±•ç¤º*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--åŠ å…¥è¡Œå·çš„é«˜äº®ä»£ç å—æ ·å¼-->

<!--è‡ªå®šä¹‰æ ·å¼è®¾ç½®-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*åˆ—è¡¨æ ·å¼*/
    

    /* èƒŒæ™¯å›¾æ ·å¼ */
    
    


    /*å¼•ç”¨å—æ ·å¼*/
    

    /*æ–‡ç« åˆ—è¡¨èƒŒæ™¯å›¾*/
    

    
</style>







</html>
